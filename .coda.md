# ExcaliWeb — Repository Overview

## Project Overview

ExcaliWeb is a self-hosted web application that wraps the Excalidraw whiteboard editor with persistent file storage. It provides a React SPA frontend with a sidebar for browsing and managing `.excalidraw` files, backed by an Express REST API that performs CRUD operations on a configurable data directory. The application supports workspace management and auto-saving, and is designed for single-container Docker deployment with nginx as a reverse proxy.

## Architecture

```
┌─────────────────────────────────────────────────┐
│                  Docker Container                │
│                                                  │
│  ┌──────────┐    ┌──────────┐    ┌───────────┐  │
│  │  nginx   │───>│  React   │    │  Express  │  │
│  │ (port 80)│    │  SPA     │    │  API      │  │
│  │          │───>│ (static) │    │ (port 3001)│  │
│  └──────────┘    └──────────┘    └─────┬─────┘  │
│       │                                │         │
│       │         /api/*                 │         │
│       └───────────────────────────────>│         │
│                                        │         │
│                               ┌────────▼───────┐ │
│                               │  Filesystem    │ │
│                               │  Service       │ │
│                               │  (data/)       │ │
│                               └────────────────┘ │
│                                                  │
│  supervisord manages nginx + node processes      │
└─────────────────────────────────────────────────┘
```

- **Frontend**: React 19 SPA built with Vite, embedding the Excalidraw editor component
- **Backend**: Express 4 REST API with file/folder CRUD and workspace management
- **Production**: nginx serves static assets and proxies `/api/*` to the Node.js backend
- **Process management**: supervisord orchestrates nginx and Node inside a single container

## Directory Guide

| Directory | Purpose |
|---|---|
| `client/src/` | React frontend source — App shell, editor, sidebar, modals, hooks, API utils |
| `client/src/components/` | UI components — Editor, Sidebar, Modal, WorkspaceModal |
| `client/src/hooks/` | Custom React hooks — auto-save logic |
| `client/src/utils/` | Client utilities — API client, file tree helpers, local storage |
| `server/src/` | Express backend source — HTTP server entry point |
| `server/src/routes/` | API route handlers — file CRUD, filesystem operations, workspace management |
| `server/src/services/` | Backend business logic — filesystem service |
| `server/src/middleware/` | Express middleware — centralized error handler |
| `server/src/types/` | Shared TypeScript type definitions for the server |
| `docker/` | Docker infrastructure — Dockerfile, compose, nginx config, supervisord, entrypoint |
| `data/` | Default workspace data directory for `.excalidraw` files (volume-mounted in Docker) |
| `specs/` | Design specifications and feature ideas |

## Tech Stack

| Category | Details |
|---|---|
| Languages | TypeScript, CSS, HTML |
| Frontend | React 19, Vite 7, @excalidraw/excalidraw 0.18 |
| Backend | Express 4, cors, Node.js |
| Linting | ESLint 9 with typescript-eslint, react-hooks, react-refresh plugins |
| Build | Vite (client), tsc (server), tsx (dev server) |
| Infrastructure | Docker (multi-stage), nginx, supervisord, Make |

## Development Workflow

### Install dependencies

```bash
npm run install:all
```

### Run in development mode

```bash
# Start both client and server
npm run dev:all

# Or separately:
npm run dev          # Client only (Vite dev server)
npm run dev:server   # Server only (tsx watch)
```

### Build

```bash
npm run build:all    # Build both client and server
npm run build        # Client only (tsc + vite build)
npm run build:server # Server only (tsc)
```

### Lint

```bash
npm run lint         # ESLint on client
```

### Docker deployment

```bash
make build           # Build Docker image
make deploy          # Build and run container (port 5174)
make logs            # View container logs
make status          # Check container status
make clean           # Stop and remove container
```

## Key Patterns

- **Auto-save**: The client uses a custom hook (`useAutoSave`) to persist Excalidraw scenes automatically
- **Workspace management**: Users can switch between workspaces; the server resolves workspace paths against the `DATA_DIR` environment variable
- **File tree**: The sidebar renders a hierarchical file tree built from the filesystem API responses
- **Centralized error handling**: The server uses Express middleware for consistent error responses
- **PUID/PGID mapping**: The Docker entrypoint maps container user/group IDs to match the host for correct file permissions
- **Root-level npm scripts**: The root `package.json` delegates to `client/` and `server/` sub-packages via `cd` and `--prefix`
